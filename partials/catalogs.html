<script type="text/ng-template" id="entries_renderer.html">
	
	<div ui-tree-handle class="catalog-entry" ng-init="entry.show = false">

		<a data-nodrag
			ng-class="{'text-muted': entry.totalChildren == 0, 'glyphicon-folder-open': !collapsed, 'glyphicon-folder-close': collapsed}"
			class="glyphicon"
			style="cursor: pointer; text-decoration: none; margin-right: 5px;"
			ng-click="toggleNode(this, entry)"></a>

		<a ng-if="entry.arachneEntityId" ng-href="entity/{{entry.arachneEntityId}}" data-nodrag>
			{{entry.label}}
		</a>
		<span ng-if="!entry.arachneEntityId">
			{{entry.label}}
		</span>
 		
		<a ng-if="entry.text" class="btn" ng-click="entry.show = !entry.show" data-nodrag>
			<span class="glyphicon glyphicon-book"></span>
		</a>
		<span ng-if="entry.arachneEntityId" class="glyphicon glyphicon-link"></span>
		
		<a class="edit-btn text-danger pull-right" ng-click="removeEntry(this, entry)" data-nodrag>
			<span class="glyphicon glyphicon-remove-sign"></span>
		</a>
		<a class="edit-btn text-success pull-right" ng-click="addChild(this, entry)" data-nodrag>
			<span class="glyphicon glyphicon-plus-sign"></span>
		</a>
		<a class="edit-btn pull-right" ng-click="editEntry(entry)" data-nodrag>
			<span class="glyphicon glyphicon-edit"></span>
		</a>

		<span ng-if="entry.text && entry.show">
			<br>
			<span markdown-to-html="entry.text"></span>
		</span>

	</div>

	<ol ng-class="{hidden:collapsed}" ui-tree-nodes ng-model="entry.children">
		<li ng-repeat="entry in entry.children" ui-tree-node collapsed="true" ng-include="'entries_renderer.html'"></li>

		<div ng-if="entry.children.length < entry.totalChildren" class="catalog-entry" style="cursor: pointer;"
			 	ng-click="loadChildren(entry)">
			<a style="display: block;">
				<em>{{ 'ui_show_more' | transl8 }}</em>
			</a>
		</div>
	</ol>

</script>

<div class="row" ng-controller="CatalogsController">

	<!-- Loading-Icon -->
	<div ng-show="loading > 0">
		<div class="loading" style="margin-top:70px;"></div>
	</div>

	<div ng-if="!user.username" class="col-md-12 text-right alert alert-info">
		{{ 'catalog_please_login' | transl8}} <span class="glyphicon glyphicon-share-alt" style="-webkit-transform:rotate(90deg) scaleX(-1); transform:rotate(90deg) scaleX(-1); margin: 0 35px; font-size: 20px;"></span>
	</div>
	
	<div class="col-md-10 col-md-offset-1" ng-if="user.username && loading <= 0">
		<div class="page-header">
			<h3>
				<span style="color: rgb(66,139,202); margin-right:10px" class="glyphicon glyphicon-inbox"></span>
				{{ 'catalog_control' | transl8 }}
			</h3>
		</div>
		
		<div class="row">
			<div ng-hide="catalogs.length >= 0" class="col-md-10">
				<div class="loading" style="margin-top:70px;"></div>
			</div>
			<div ng-if="activeCatalog" class="col-md-10 catalog-edit">
				<h3>
					<b>{{activeCatalog.root.label}}</b> <small>{{ 'catalog_author' | transl8 }}: {{activeCatalog.author}}</small>
					<div class="btn-group btn-group-xs pull-right">
						<button class="btn btn-default" ng-click="editCatalog()">
							<span class="glyphicon glyphicon-edit"></span> {{ 'catalog_edit' | transl8 }}
						</button>
						<button class="btn btn-default" ng-click="removeCatalog()">
							<span class="glyphicon glyphicon-remove"></span> {{ 'catalogIds' | transl8 }} {{ 'ui_delete' | transl8 }}
						</button>
					</div>
				</h3>

				<div ng-if="activeCatalog.root.children.length > 0" ui-tree="treeOptions" id="tree-root">
					<ol ui-tree-nodes="nodes" ng-model="activeCatalog.root.children" ng-class="{hidden: collapsed}">
						<li ng-repeat="entry in activeCatalog.root.children"
								ui-tree-node collapsed="true"
								ng-include="'entries_renderer.html'">
						</li>
					</ol>
				</div>

				<div class="catalog-entry" style="cursor: pointer;" ng-click="addChild(null, activeCatalog.root)">
					<a style="display: block;">
						<em><span class="glyphicon glyphicon-plus-sign"></span> {{ 'catalog_create_entry' | transl8 }}</em>
					</a>
				</div>

			</div>

			<div class="col-md-2">
				<h4>{{ 'catalog_your_catalog' | transl8 }}</h4>
				<ul class="nav nav-pills nav-stacked">
					<li ng-repeat="catalog in catalogs" ng-class="{ active: activeCatalog.root.id == catalog.root.id }">
						<a ng-click="setActiveCatalog(catalog)" style="cursor:pointer">
							{{catalog.root.label}}
						</a>
					</li>
				</ul>
				<div ng-if="catalogs.length == 0">
					<em>{{ 'catalog_no_catalog' | transl8 }}</em>
				</div>
				<br>
				<button type="button" class="btn btn-default btn-sm" ng-click="createCatalog()">
					<span class="glyphicon glyphicon-plus"></span> {{ 'catalog_add' | transl8 }}
				</button>
			</div>

		</div>

  	</div>
</div>